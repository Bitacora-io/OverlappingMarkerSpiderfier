!function(t,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.OverlappingMarkerSpiderfier=r():t.OverlappingMarkerSpiderfier=r()}(this,function(){return function(t){function r(i){if(e[i])return e[i].exports;var n=e[i]={exports:{},id:i,loaded:!1};return t[i].call(n.exports,n,n.exports,r),n.loaded=!0,n.exports}var e={};return r.m=t,r.c=e,r.p="/dist/",r(0)}([function(t,r,e){t.exports=e(1)},function(t,r){/** @preserve OverlappingMarkerSpiderfier
	https://github.com/jawj/OverlappingMarkerSpiderfier
	Copyright (c) 2011 - 2017 George MacKerron
	Released under the MIT licence: http://opensource.org/licenses/mit-license
	 */
var e,i,n,s,a,o,l={}.hasOwnProperty,h=[].slice;this.OverlappingMarkerSpiderfier=function(){function t(t,i){var n,o,h,f;this.map=t,null==i&&(i={}),null==this.constructor.hasInitialized&&(this.constructor.hasInitialized=!0,e=google.maps,r=e.event,s=e.MapTypeId,a.keepSpiderfied=!1,a.ignoreMapClick=!1,a.markersWontHide=!1,a.markersWontMove=!1,a.basicFormatEvents=!1,a.nearbyDistance=20,a.circleSpiralSwitchover=9,a.circleFootSeparation=23,a.circleStartAngle=u/12,a.spiralFootSeparation=26,a.spiralLengthStart=11,a.spiralLengthFactor=4,a.spiderfiedZIndex=e.Marker.MAX_ZINDEX+2e4,a.highlightedLegZIndex=e.Marker.MAX_ZINDEX+1e4,a.usualLegZIndex=e.Marker.MAX_ZINDEX+1,a.legWeight=1.5,a.legColors={usual:{},highlighted:{}},h=a.legColors.usual,o=a.legColors.highlighted,h[s.HYBRID]=h[s.SATELLITE]="#fff",o[s.HYBRID]=o[s.SATELLITE]="#f00",h[s.TERRAIN]=h[s.ROADMAP]="#444",o[s.TERRAIN]=o[s.ROADMAP]="#f00",this.constructor.ProjHelper=function(t){return this.setMap(t)},this.constructor.ProjHelper.prototype=new e.OverlayView,this.constructor.ProjHelper.prototype.draw=function(){});for(n in i)l.call(i,n)&&(f=i[n],this[n]=f);this.projHelper=new this.constructor.ProjHelper(this.map),this.initMarkerArrays(),this.listeners={},this.formatIdleListener=this.formatTimeoutId=null,this.addListener("click",function(t,e){return r.trigger(t,"spider_click",e)}),this.addListener("format",function(t,e){return r.trigger(t,"spider_format",e)}),this.ignoreMapClick||r.addListener(this.map,"click",function(t){return function(){return t.unspiderfy()}}(this)),r.addListener(this.map,"maptypeid_changed",function(t){return function(){return t.unspiderfy()}}(this)),r.addListener(this.map,"zoom_changed",function(t){return function(){if(t.unspiderfy(),!t.basicFormatEvents)return t.formatMarkers()}}(this))}var r,e,i,n,s,a,o,u,f;for(a=t.prototype,o=[t,a],i=0,n=o.length;i<n;i++)f=o[i],f.VERSION="1.0.3";return u=2*Math.PI,e=r=s=null,t.markerStatus={SPIDERFIED:"SPIDERFIED",SPIDERFIABLE:"SPIDERFIABLE",UNSPIDERFIABLE:"UNSPIDERFIABLE",UNSPIDERFIED:"UNSPIDERFIED"},a.initMarkerArrays=function(){return this.markers=[],this.markerListenerRefs=[]},a.addMarker=function(t,r){return t.setMap(this.map),this.trackMarker(t,r)},a.trackMarker=function(t,e){var i;return null!=t._oms?this:(t._oms=!0,i=[r.addListener(t,"click",function(r){return function(e){return r.spiderListener(t,e)}}(this))],this.markersWontHide||i.push(r.addListener(t,"visible_changed",function(r){return function(){return r.markerChangeListener(t,!1)}}(this))),this.markersWontMove||i.push(r.addListener(t,"position_changed",function(r){return function(){return r.markerChangeListener(t,!0)}}(this))),null!=e&&i.push(r.addListener(t,"spider_click",e)),this.markerListenerRefs.push(i),this.markers.push(t),this.basicFormatEvents?this.trigger("format",t,this.constructor.markerStatus.UNSPIDERFIED):(this.trigger("format",t,this.constructor.markerStatus.UNSPIDERFIABLE),this.formatMarkers()),this)},a.markerChangeListener=function(t,r){if(!this.spiderfying&&!this.unspiderfying)return null==t._omsData||!r&&t.getVisible()||this.unspiderfy(r?t:null),this.formatMarkers()},a.getMarkers=function(){return this.markers.slice(0)},a.removeMarker=function(t){return this.forgetMarker(t),t.setMap(null)},a.forgetMarker=function(t){var e,i,n,s,a;if(null!=t._omsData&&this.unspiderfy(),e=this.arrIndexOf(this.markers,t),e<0)return this;for(a=this.markerListenerRefs.splice(e,1)[0],i=0,n=a.length;i<n;i++)s=a[i],r.removeListener(s);return delete t._oms,this.markers.splice(e,1),this.formatMarkers(),this},a.removeAllMarkers=a.clearMarkers=function(){var t,r,e,i;for(i=this.getMarkers(),this.forgetAllMarkers(),t=0,r=i.length;t<r;t++)e=i[t],e.setMap(null);return this},a.forgetAllMarkers=function(){var t,e,i,n,s,a,o,l,h;for(this.unspiderfy(),h=this.markers,t=e=0,i=h.length;e<i;t=++e){for(o=h[t],a=this.markerListenerRefs[t],l=0,n=a.length;l<n;l++)s=a[l],r.removeListener(s);delete o._oms}return this.initMarkerArrays(),this},a.addListener=function(t,r){var e;return(null!=(e=this.listeners)[t]?e[t]:e[t]=[]).push(r),this},a.removeListener=function(t,r){var e;return e=this.arrIndexOf(this.listeners[t],r),e<0||this.listeners[t].splice(e,1),this},a.clearListeners=function(t){return this.listeners[t]=[],this},a.trigger=function(){var t,r,e,i,n,s,a,o;for(r=arguments[0],t=2<=arguments.length?h.call(arguments,1):[],a=null!=(s=this.listeners[r])?s:[],o=[],i=0,n=a.length;i<n;i++)e=a[i],o.push(e.apply(null,t));return o},a.generatePtsCircle=function(t,r){var i,n,s,a,o,l,h,f;for(s=this.circleFootSeparation*(2+t),l=s/u,n=u/t,f=[],a=o=0,h=t;0<=h?o<h:o>h;a=0<=h?++o:--o)i=this.circleStartAngle+a*n,f.push(new e.Point(r.x+l*Math.cos(i),r.y+l*Math.sin(i)));return f},a.generatePtsSpiral=function(t,r){var i,n,s,a,o,l,h;for(a=this.spiralLengthStart,i=0,h=[],n=s=0,l=t;0<=l?s<l:s>l;n=0<=l?++s:--s)i+=this.spiralFootSeparation/a+5e-4*n,o=new e.Point(r.x+a*Math.cos(i),r.y+a*Math.sin(i)),a+=u*this.spiralLengthFactor/i,h.push(o);return h},a.spiderListener=function(t,r){var e,i,n,s,a,o,l,h,u,f,p;if(o=null!=t._omsData,o&&this.keepSpiderfied||this.unspiderfy(),o||this.map.getStreetView().getVisible()||"GoogleEarthAPI"===this.map.getMapTypeId())return this.trigger("click",t,r);for(h=[],u=[],l=this.nearbyDistance,f=l*l,a=this.llToPt(t.position),p=this.markers,e=0,i=p.length;e<i;e++)n=p[e],null!=n.map&&n.getVisible()&&(s=this.llToPt(n.position),this.ptDistanceSq(s,a)<f?h.push({marker:n,markerPt:s}):u.push(n));return 1===h.length?this.trigger("click",t,r):this.spiderfy(h,u)},a.markersNearMarker=function(t,r){var e,i,n,s,a,o,l,h,u,f,p;if(null==r&&(r=!1),null==this.projHelper.getProjection())throw"Must wait for 'idle' event on map before calling markersNearMarker";for(l=this.nearbyDistance,h=l*l,a=this.llToPt(t.position),o=[],u=this.markers,e=0,i=u.length;e<i&&(n=u[e],!(n!==t&&null!=n.map&&n.getVisible()&&(s=this.llToPt(null!=(f=null!=(p=n._omsData)?p.usualPosition:void 0)?f:n.position),this.ptDistanceSq(s,a)<h&&(o.push(n),r))));e++);return o},a.markerProximityData=function(){var t,r,e,i,n,s,a,o,l,h,u,f,p,c,g,d;if(null==this.projHelper.getProjection())throw"Must wait for 'idle' event on map before calling markersNearAnyOtherMarker";for(p=this.nearbyDistance,c=p*p,u=function(){var t,r,e,i,n,a;for(e=this.markers,a=[],t=0,r=e.length;t<r;t++)s=e[t],a.push({pt:this.llToPt(null!=(i=null!=(n=s._omsData)?n.usualPosition:void 0)?i:s.position),willSpiderfy:!1});return a}.call(this),g=this.markers,t=e=0,i=g.length;e<i;t=++e)if(a=g[t],null!=a.getMap()&&a.getVisible()&&(o=u[t],!o.willSpiderfy))for(d=this.markers,r=f=0,n=d.length;f<n;r=++f)if(l=d[r],r!==t&&null!=l.getMap()&&l.getVisible()&&(h=u[r],(!(r<t)||h.willSpiderfy)&&this.ptDistanceSq(o.pt,h.pt)<c)){o.willSpiderfy=h.willSpiderfy=!0;break}return u},a.markersNearAnyOtherMarker=function(){var t,r,e,i,n,s,a;for(n=this.markerProximityData(),s=this.markers,a=[],t=r=0,e=s.length;r<e;t=++r)i=s[t],n[t].willSpiderfy&&a.push(i);return a},a.setImmediate=function(t){return window.setTimeout(t,0)},a.formatMarkers=function(){if(!this.basicFormatEvents&&null==this.formatTimeoutId)return this.formatTimeoutId=this.setImmediate(function(t){return function(){return t.formatTimeoutId=null,null!=t.projHelper.getProjection()?t._formatMarkers():null==t.formatIdleListener?t.formatIdleListener=r.addListenerOnce(t.map,"idle",function(){return t._formatMarkers()}):void 0}}(this))},a._formatMarkers=function(){var t,r,e,i,n,s,a,o,l,h,u;if(this.basicFormatEvents){for(l=[],r=0,e=markers.length;r<e;r++)n=markers[r],u=null!=n._omsData?"SPIDERFIED":"UNSPIDERFIED",l.push(this.trigger("format",n,this.constructor.markerStatus[u]));return l}for(a=this.markerProximityData(),o=this.markers,h=[],t=s=0,i=o.length;s<i;t=++s)n=o[t],u=null!=n._omsData?"SPIDERFIED":a[t].willSpiderfy?"SPIDERFIABLE":"UNSPIDERFIABLE",h.push(this.trigger("format",n,this.constructor.markerStatus[u]));return h},a.makeHighlightListenerFuncs=function(t){return{highlight:function(r){return function(){return t._omsData.leg.setOptions({strokeColor:r.legColors.highlighted[r.map.mapTypeId],zIndex:r.highlightedLegZIndex})}}(this),unhighlight:function(r){return function(){return t._omsData.leg.setOptions({strokeColor:r.legColors.usual[r.map.mapTypeId],zIndex:r.usualLegZIndex})}}(this)}},a.spiderfy=function(t,i){var n,s,a,o,l,h,u,f,p,c,g;return this.spiderfying=!0,c=t.length,n=this.ptAverage(function(){var r,e,i;for(i=[],r=0,e=t.length;r<e;r++)f=t[r],i.push(f.markerPt);return i}()),o=c>=this.circleSpiralSwitchover?this.generatePtsSpiral(c,n).reverse():this.generatePtsCircle(c,n),g=function(){var i,n,f;for(f=[],i=0,n=o.length;i<n;i++)a=o[i],s=this.ptToLl(a),p=this.minExtract(t,function(t){return function(r){return t.ptDistanceSq(r.markerPt,a)}}(this)),u=p.marker,h=new e.Polyline({map:this.map,path:[u.position,s],strokeColor:this.legColors.usual[this.map.mapTypeId],strokeWeight:this.legWeight,zIndex:this.usualLegZIndex}),u._omsData={usualPosition:u.getPosition(),usualZIndex:u.getZIndex(),leg:h},this.legColors.highlighted[this.map.mapTypeId]!==this.legColors.usual[this.map.mapTypeId]&&(l=this.makeHighlightListenerFuncs(u),u._omsData.hightlightListeners={highlight:r.addListener(u,"mouseover",l.highlight),unhighlight:r.addListener(u,"mouseout",l.unhighlight)}),this.trigger("format",u,this.constructor.markerStatus.SPIDERFIED),u.setPosition(s),u.setZIndex(Math.round(this.spiderfiedZIndex+a.y)),f.push(u);return f}.call(this),delete this.spiderfying,this.spiderfied=!0,this.trigger("spiderfy",g,i)},a.unspiderfy=function(t){var e,i,n,s,a,o,l,h;if(null==t&&(t=null),null==this.spiderfied)return this;for(this.unspiderfying=!0,h=[],a=[],o=this.markers,e=0,i=o.length;e<i;e++)s=o[e],null!=s._omsData?(s._omsData.leg.setMap(null),s!==t&&s.setPosition(s._omsData.usualPosition),s.setZIndex(s._omsData.usualZIndex),n=s._omsData.hightlightListeners,null!=n&&(r.removeListener(n.highlight),r.removeListener(n.unhighlight)),delete s._omsData,s!==t&&(l=this.basicFormatEvents?"UNSPIDERFIED":"SPIDERFIABLE",this.trigger("format",s,this.constructor.markerStatus[l])),h.push(s)):a.push(s);return delete this.unspiderfying,delete this.spiderfied,this.trigger("unspiderfy",h,a),this},a.ptDistanceSq=function(t,r){var e,i;return e=t.x-r.x,i=t.y-r.y,e*e+i*i},a.ptAverage=function(t){var r,i,n,s,a,o;for(a=o=0,r=0,i=t.length;r<i;r++)s=t[r],a+=s.x,o+=s.y;return n=t.length,new e.Point(a/n,o/n)},a.llToPt=function(t){return this.projHelper.getProjection().fromLatLngToDivPixel(t)},a.ptToLl=function(t){return this.projHelper.getProjection().fromDivPixelToLatLng(t)},a.minExtract=function(t,r){var e,i,n,s,a,o,l;for(n=a=0,o=t.length;a<o;n=++a)s=t[n],l=r(s),("undefined"==typeof e||null===e||l<i)&&(i=l,e=n);return t.splice(e,1)[0]},a.arrIndexOf=function(t,r){var e,i,n,s;if(null!=t.indexOf)return t.indexOf(r);for(e=i=0,n=t.length;i<n;e=++i)if(s=t[e],s===r)return e;return-1},t}(),i=/(\?.*(&|&amp;)|\?)spiderfier_callback=(\w+)/,a=document.currentScript,null==a&&(a=function(){var t,r,e,n,s;for(e=document.getElementsByTagName("script"),s=[],t=0,r=e.length;t<r;t++)o=e[t],(null!=(n=o.getAttribute("src"))?n.match(i):void 0)&&s.push(o);return s}()[0]),null!=a&&(e=null!=(n=a.getAttribute("src"))&&null!=(s=n.match(i))?s[3]:void 0,e&&"function"==typeof window[e]&&window[e]()),"function"==typeof window.spiderfier_callback&&window.spiderfier_callback()}])});